/*
*  field-group.js
*
*  All javascript needed to create a field group
*
*  @type	JS
*  @date	1/08/13
*/var acf={ajaxurl:"",admin_url:"",post_id:0,nonce:"",l10n:{},text:{},helpers:{uniqid:null,sortable:null,create_field:null},conditional_logic:null,location:null};!function(e){function t(){e("#acf_fields .fields").each(function(){e(this).children(".field").each(function(t){e(this).find("td.field_order .circle").first().html(t+1)})})}e.fn.exists=function(){return e(this).length>0},acf.helpers.sortable=function(t,i){return i.children().each(function(){e(this).width(e(this).width())}),i},acf.helpers.uniqid=function(e,t){"undefined"==typeof e&&(e="");var i,a=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed++,i=e,i+=a(parseInt((new Date).getTime()/1e3,10),8),i+=a(this.php_js.uniqidSeed,5),t&&(i+=(10*Math.random()).toFixed(8).toString()),i},e(document).on("submit","#post",function(){var t=e("#titlewrap #title");return t.val()?void 0:(alert(acf.l10n.title),t.focus(),!1)}),e(document).on("click","#submit-delete",function(){var e=confirm(acf.l10n.move_to_trash);return e?void 0:!1}),e(document).on("change","#acf_fields tr.field_type select",function(){var t=e(this),i=t.closest("tbody"),a=i.closest(".field"),n=a.attr("data-type"),l=(a.attr("data-id"),t.val());if(a.removeClass("field_type-"+n).addClass("field_type-"+l),a.attr("data-type",l),("tab"==l||"message"==l)&&i.find('tr.field_name input[type="text"]').val("").trigger("keyup"),i.children("tr.field_option_"+l).exists())i.children("tr.field_option").hide().find("[name]").attr("disabled","true"),i.children("tr.field_option_"+l).show().find("[name]").removeAttr("disabled");else{var o=e('<tr"><td class="label"></td><td><div class="acf-loading"></div></td></tr>');i.children("tr.field_option").hide().find("[name]").attr("disabled","true"),i.children("tr.conditional-logic").exists()?i.children("tr.conditional-logic").before(o):i.children("tr.field_save").before(o);var c={action:"acf/field_group/render_options",post_id:acf.post_id,field_key:t.attr("name"),field_type:l,nonce:acf.nonce};e.ajax({url:ajaxurl,data:c,type:"post",dataType:"html",success:function(e){return e?void o.replaceWith(e):void o.remove()}})}}),e.fn.update_names=function(){var t=e(this),i=t.attr("data-id"),a="field_"+acf.helpers.uniqid();t.attr("data-id",a),t.attr("class",t.attr("class").replace(i,a)),t.find(".field_meta td.field_key").text(a),t.find('[id*="'+i+'"]').each(function(){e(this).attr("id",e(this).attr("id").replace(i,a))}),t.find('[name*="'+i+'"]').each(function(){e(this).attr("name",e(this).attr("name").replace(i,a))})},e(document).on("click","#acf_fields a.acf_edit_field",function(){var t=e(this).closest(".field");t.hasClass("form_open")?(t.removeClass("form_open"),e(document).trigger("acf/field_form-close",[t])):(t.addClass("form_open"),e(document).trigger("acf/field_form-open",[t])),t.children(".field_form_mask").animate({height:"toggle"},250)}),e(document).on("click","#acf_fields a.acf_delete_field",function(){var i=e(this),a=i.closest(".field"),n=a.closest(".fields"),l=e('<div style="height:'+a.height()+'px"></div>');a.animate({left:"50px",opacity:0},250,function(){a.before(l),a.remove(),n.children(".field").length<=1?(l.remove(),n.children(".no_fields_message").show()):l.animate({height:0},250,function(){l.remove()}),t()})}),e(document).on("click","#acf_fields a.acf_duplicate_field",function(){var i=e(this),a=i.closest(".field"),n=null;a.find("select").each(function(){e(this).attr("data-val",e(this).val())}),n=a.clone(),n.update_names(),n.find(".field:not(.field_key-field_clone)").each(function(){e(this).update_names()}),a.after(n),n.find("select").each(function(){e(this).val(e(this).attr("data-val")).trigger("change")}),a.hasClass("form_open")?a.find(".acf_edit_field").first().trigger("click"):n.find(".acf_edit_field").first().trigger("click");var l=n.find('tr.field_label:first input[type="text"]'),o=n.find('tr.field_name:first input[type="text"]');o.val(""),l.val(l.val()+" ("+acf.l10n.copy+")"),l.trigger("blur").trigger("keyup"),t()}),e(document).on("click","#acf_fields #add_field",function(){var i=e(this).closest(".table_footer").siblings(".fields"),a=i.children(".field_key-field_clone").clone();return a.update_names(),a.show(),i.children(".field_key-field_clone").before(a),i.children(".no_fields_message").exists()&&i.children(".no_fields_message").hide(),a.find("tr.field_type select").trigger("change"),a.find('.field_form input[type="text"]').val(""),setTimeout(function(){a.find('.field_form input[type="text"]').first().focus()},500),a.find("a.acf_edit_field").first().trigger("click"),t(),!1}),e(document).on("blur","#acf_fields tr.field_label input.label",function(){var t=e(this),i=t.closest(".field"),a=i.find('tr.field_name:first input[type="text"]'),n=i.attr("data-type");if("tab"==n||"message"==n)return void a.val("").trigger("keyup");if(""==a.val()){var l=t.val(),o={"ä":"a","æ":"a","å":"a","ö":"o","ø":"o","é":"e","ë":"e","ü":"u","ó":"o","ő":"o","ú":"u","é":"e","á":"a","ű":"u","í":"i"," ":"_","'":"","\\?":""};e.each(o,function(e,t){var i=new RegExp(e,"g");l=l.replace(i,t)}),l=l.toLowerCase(),a.val(l),a.trigger("keyup")}}),e(document).on("keyup","#acf_fields .field_form tr.field_label input.label",function(){{var t=e(this).val();e(this).closest(".field").find("td.field_label strong a").first().text(t)}}),e(document).on("keyup","#acf_fields .field_form tr.field_name input.name",function(){{var t=e(this).val();e(this).closest(".field").find("td.field_name").first().text(t)}}),e(document).on("change","#acf_fields .field_form tr.field_type select",function(){var t=e(this).val(),i=e(this).find('option[value="'+t+'"]').html();e(this).closest(".field").find("td.field_type").first().text(i)}),e(document).on("mouseover","#acf_fields td.field_order",function(){var i=e(this).closest(".fields");return i.hasClass("sortable")?!1:void i.addClass("sortable").sortable({update:function(){t()},handle:"td.field_order"})}),e(document).ready(function(){acf.location.init(),acf.conditional_logic.init()}),acf.location={$el:null,init:function(){var t=this;t.$el=e("#acf_location"),t.$el.on("click",".location-add-rule",function(){return t.add_rule(e(this).closest("tr")),!1}),t.$el.on("click",".location-remove-rule",function(){return t.remove_rule(e(this).closest("tr")),!1}),t.$el.on("click",".location-add-group",function(){return t.add_group(),!1}),t.$el.on("change",".param select",function(){var t=e(this).closest("tr"),i=t.attr("data-id"),a=t.closest(".location-group"),n=a.attr("data-id"),l={action:"acf/field_group/render_location",nonce:acf.nonce,rule_id:i,group_id:n,value:"",param:e(this).val()},o=e('<div class="acf-loading"></div>');t.find("td.value").html(o),e.ajax({url:acf.ajaxurl,data:l,type:"post",dataType:"html",success:function(e){o.replaceWith(e)}})})},add_rule:function(t){var i=t.clone(),a=i.attr("data-id"),n=acf.helpers.uniqid();return i.find("[name]").each(function(){e(this).attr("name",e(this).attr("name").replace(a,n)),e(this).attr("id",e(this).attr("id").replace(a,n))}),i.attr("data-id",n),t.after(i),!1},remove_rule:function(e){var t=e.siblings("tr").length;0==t?this.remove_group(e.closest(".location-group")):e.remove()},add_group:function(){var t=this.$el.find(".location-group:last"),i=t.clone(),a=i.attr("data-id"),n=acf.helpers.uniqid();i.find("[name]").each(function(){e(this).attr("name",e(this).attr("name").replace(a,n)),e(this).attr("id",e(this).attr("id").replace(a,n))}),i.attr("data-id",n),i.find("h4").text(acf.l10n.or),i.find("tr:not(:first)").remove(),t.after(i)},remove_group:function(e){e.remove()}},e(document).ready(function(){e("#submitdiv #publish").attr("class","acf-button large"),e("#submitdiv a.submitdelete").attr("class","delete-field-group").attr("id","submit-delete");var t=e("#hide-on-screen ul.acf-checkbox-list"),i=e('<li><label><input type="checkbox" value="" name="" >'+acf.l10n.hide_show_all+"</label></li>");0==t.find("input:not(:checked)").length&&i.find("input").attr("checked","checked"),i.on("change","input",function(){var i=e(this).is(":checked");t.find("input").attr("checked",i)}),t.prepend(i)}),e(document).on("change",'#adv-settings input[name="show-field_key"]',function(){"1"==e(this).val()?e("#acf_fields table.acf").addClass("show-field_key"):e("#acf_fields table.acf").removeClass("show-field_key")}),acf.helpers.create_field=function(t){var i={type:"text",classname:"",name:"",value:""};t=e.extend(!0,i,t);var a="";if("text"==t.type)a+='<input class="text '+t.classname+'" type="text" id="'+t.name+'" name="'+t.name+'" value="'+t.value+'" />';else if("select"==t.type){var n={};e.each(t.choices,function(e,t){void 0===t.group&&(t.group=0),void 0===n[t.group]&&(n[t.group]=[]),n[t.group].push(t)}),a+='<select class="select '+t.classname+'" id="'+t.name+'" name="'+t.name+'">',e.each(n,function(i,n){0!=i&&(a+='<optgroup label="'+i+'">'),e.each(n,function(e,i){var n="";i.value==t.value&&(n='selected="selected"'),a+="<option "+n+' value="'+i.value+'">'+i.label+"</option>"}),0!=i&&(a+="</optgroup>")}),a+="</select>"}return a=e(a)},acf.conditional_logic={triggers:null,init:function(){var t=this;e(document).on("acf/field_form-open",function(e,i){t.render(i)}),e(document).on("change","#acf_fields tr.field_label input.label",function(){e("#acf_fields .field.form_open").each(function(){t.render(e(this))})}),e(document).on("change",'tr.conditional-logic input[type="radio"]',function(i){i.preventDefault(),t.change_toggle(e(this))}),e(document).on("change","select.conditional-logic-field",function(i){i.preventDefault(),t.change_trigger(e(this))}),e(document).on("click","tr.conditional-logic .acf-button-add",function(i){i.preventDefault(),t.add(e(this).closest("tr"))}),e(document).on("click","tr.conditional-logic .acf-button-remove",function(i){i.preventDefault(),t.remove(e(this).closest("tr"))})},render:function(t){var i=[],a=t.attr("data-id"),n=t.parents(".fields"),l=t.find("> .field_form_mask > .field_form > table > tbody > tr.conditional-logic");e.each(n,function(t){var n=0==t?acf.l10n.sibling_fields:acf.l10n.parent_fields;e(this).children(".field").each(function(){var t=e(this),l=t.attr("data-id"),o=t.attr("data-type"),c=t.find("tr.field_label input").val();"field_clone"!=l&&l!=a&&("select"==o||"checkbox"==o||"true_false"==o||"radio"==o)&&i.push({value:l,label:c,group:n})})}),0==i.length&&i.push({value:"null",label:acf.l10n.no_fields}),l.find(".conditional-logic-field").each(function(){var t=e(this).val(),a=e(this).attr("name"),n=acf.helpers.create_field({type:"select",classname:"conditional-logic-field",name:a,value:t,choices:i});e(this).replaceWith(n),n.trigger("change")})},change_toggle:function(e){var t=e.val(),i=e.closest("tr.conditional-logic");"1"==t?i.find(".contional-logic-rules-wrapper").show():i.find(".contional-logic-rules-wrapper").hide()},change_trigger:function(t){var i=t.val(),a=e(".field_key-"+i),n=a.attr("data-type"),l=t.closest("tr").find(".conditional-logic-value"),o=[];if("true_false"==n)o=[{value:1,label:acf.l10n.checked}];else if("select"==n||"checkbox"==n||"radio"==n){var c=a.find(".field_option-choices").val().split("\n");if(c)for(var r=0;r<c.length;r++){var d=c[r].split(":"),s=d[0];d[1]&&(s=d[1]),o.push({value:e.trim(d[0]),label:e.trim(s)})}}var t=acf.helpers.create_field({type:"select",classname:"conditional-logic-value",name:l.attr("name"),value:l.val(),choices:o});l.replaceWith(t),t.trigger("change")},add:function(t){var i=t.clone(),a=parseFloat(t.attr("data-i")),n=acf.helpers.uniqid();i.find("[name]").each(function(){var t="[conditional_logic][rules]["+a+"]",i="[conditional_logic][rules]["+n+"]";e(this).attr("name",e(this).attr("name").replace(t,i)),e(this).attr("id",e(this).attr("id").replace(t,i))}),i.attr("data-i",n),t.after(i),t.closest("table").removeClass("remove-disabled")},remove:function(e){var t=e.closest("table");return t.hasClass("remove-disabled")?!1:(e.remove(),void(t.find("tr").length<=1&&t.addClass("remove-disabled")))}},e(document).on("change",".radio-option-other_choice input",function(){var t=e(this),i=t.closest("td");t.is(":checked")?i.find(".radio-option-save_other_choice").show():(i.find(".radio-option-save_other_choice").hide(),i.find(".radio-option-save_other_choice input").removeAttr("checked"))})}(jQuery);